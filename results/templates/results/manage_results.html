{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/results/manage.css' %}">
{% endblock %}

{% block content %}
<div class="results-container">

    <!-- Header -->
    <div class="page-header">
        <div>
            <h2>Manage Results</h2>
            <p>View and manage uploaded candidate results</p>
        </div>
        <div class="results-badge">
            {{ count }} Result{{ count|pluralize }}
        </div>
    </div>

    <!-- Mock Filter Buttons -->
    <div class="filter-section">
        <div class="filter-buttons">
            <a href="{% url 'manage_results' %}"
               class="filter-btn {% if not mock %}active{% endif %}">
                All Mocks
            </a>

            {% for m in mock_numbers %}
                <a href="?mock={{ m }}"
                   class="filter-btn {% if mock == m %}active{% endif %}">
                    Mock {{ m }}
                </a>
            {% endfor %}
        </div>
    </div>

    <!-- Search -->
    <div class="search-section">
        <form method="get" class="search-form">
            {% if mock %}
                <input type="hidden" name="mock" value="{{ mock }}">
            {% endif %}

            <input type="text"
                   name="q"
                   value="{{ query }}"
                   class="search-input"
                   placeholder="Search by index number or name...">
            <button type="submit" class="search-btn">
                ğŸ” Search
            </button>
        </form>
    </div>

    <!-- Result Cards -->
    <div class="results-grid">
        {% for r in results %}
        <div class="result-card">

            <!-- Student Header -->
            <div class="student-header">
                {% if r.student.photo %}
                    <img src="{{ r.student.photo.url }}"
                         class="student-photo"
                         alt="{{ r.student.full_name }}">
                {% else %}
                    <img src="https://via.placeholder.com/80x80/e5e7eb/6b7280?text=No+Photo"
                         class="student-photo"
                         alt="No photo">
                {% endif %}

                <div class="student-info">
                    <h6 class="student-name">
                        {{ r.student.full_name }}
                    </h6>
                    <small class="student-index">
                        {{ r.student.index_number }}
                    </small>
                    <span class="mock-badge">
                        Mock {{ r.mock_number }}
                    </span>
                </div>
            </div>

            <hr class="divider">

            <!-- Actions -->
            <div class="card-actions">
                <a href="{% url 'view_student_mock' %}?student={{ r.student.id }}&mock={{ r.mock_number }}"
                   class="action-btn btn-view">
                    ğŸ‘ï¸ View
                </a>

                <button class="action-btn btn-edit"
                        data-bs-toggle="modal"
                        data-bs-target="#editResultModal{{ r.id }}">
                    âœï¸ Edit
                </button>

                <button class="action-btn btn-delete"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteMockModal{{ r.id }}">
                    ğŸ—‘ï¸ Delete
                </button>
            </div>

        </div>

        <!-- MODALS -->
        {% include "results/modals/_edit_result_modal.html" with result=r %}
        {% include "results/modals/_delete_mock_modal.html" with result=r %}

        {% empty %}
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ“Š</div>
            <p>No results found.</p>
        </div>
        {% endfor %}
    </div>

</div>

{% endblock %}
